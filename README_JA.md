[中文](README.md) | [English](README_EN.md) | [日本語](README_JA.md)

---

# Gophish Enhanced Edition - レッドチーム強化版

<div align="center">

![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Go Version](https://img.shields.io/badge/go-1.15+-00ADD8.svg)
![Platform](https://img.shields.io/badge/platform-Linux%20%7C%20macOS-lightgrey.svg)

**公式Gophishをベースに深度カスタマイズされたエンタープライズフィッシング演習プラットフォーム**

**レッドチーム評価（Red Teaming）とセキュリティ意識向上トレーニングに最適化**

[コア機能](#-コア機能) •
[クイックスタート](#-クイックスタート) •
[詳細機能](#-詳細機能) •
[設定](#-設定) •
[セキュリティポリシー](#-セキュリティポリシー)

</div>

---

## 💡 プロジェクト紹介

Gophish Enhanced Edition（強化版）は、オリジナルのGophish v0.12.1をベースにした深度改善バージョンです。実際のレッドチーム演習や企業セキュリティトレーニングで遭遇する一般的な課題（メールブロック、明白なフィンガープリント、ローカリゼーション不足など）に対処するため、広範なコードレベルの最適化と機能強化が行われています。

**なぜ強化版なのか？**

- 🛡️ **高いステルス性**：ウイルス対策ソフトやメールゲートウェイによるブロックを引き起こす指紋特徴をすべて削除しました。
- 📧 **高い到達率**：自動MIMEダウングレードとネイティブQRコード技術により、メールが正確に配信・表示されることを保証します。
- 🌏 **ローカライズ体験**：完全な中国語管理インターフェースにより、操作のハードルを下げています。
- ⚡ **すぐに使用可能**：ワンクリックデプロイソリューション（オプション）を内蔵し、複雑な環境設定は不要です。

---

## ✨ コア機能

オリジナルのGophishと比較して、Enhanced Editionは以下の画期的な改善を実現しています：

| 改善点 | オリジナルの課題 | Enhanced Editionのソリューション |
|-------|-----------------|---------------------------------|
| **フィンガープリント** | `X-Gophish`ヘッダーでツールIDが露出 | ✅ **ゼロ特徴**：すべての識別ヘッダーを削除、送信クライアントを偽装（Zoho/Outlook） |
| **QRコード** | リモート画像参照はIPを露出し、ブロックされやすい | ✅ **CID埋め込み技術**：QRコードを添付ファイルとしてメールと一緒に送信、**オフライン表示可能、表示率100%** |
| **メール配信** | プレーンテキスト不足でスパム判定されやすい | ✅ **スマートダウングレード**：HTMLを自動的にプレーンテキストに変換し、RFC標準に準拠 |
| **UI** | 英語のみのインターフェース | ✅ **深度ローカライズ**：キャンペーン、テンプレート、ユーザー管理などのコアページを完全ローカライズ |
| **追跡防止** | デフォルトの404ページと固定ルートで追跡されやすい | ✅ **動的カモフラージュ**：カスタム404ページ、静的リソース（.js, .png）に偽装したルート |

---

## 🔍 詳細機能解説

### 1. ネイティブQRコード (CID Embedded)

これは本バージョンの最も核心的な機能の一つです。従来のフィッシングメールでのQRコード挿入は通常 `<img src="http://phish-server/qrcode.png">` を使用していました。この方法には2つの致命的な弱点があります：
1. 多くの企業メールはデフォルトでリモート画像をブロックします。
2. 画像リクエストは受信者のIPアドレスを露出し、ゲートウェイによって容易に傍受されます。

**Enhancedのメカニズム**：
メール送信モジュールを書き換え、**MIME CID (Content-ID)** メカニズムを使用するようにしました。QRコードは送信時に即座に生成され、**埋め込み添付ファイル**としてメールと一緒に送信されます。

**利点**：
- 💯 **表示率100%**：画像はメールの一部であり、外部ネットワークに依存しません。
- 🔒 **より安全**：リモート画像読み込み警告をトリガーしません。

**使用方法**：
メールテンプレートで `{{.QR}}` 変数を直接使用するだけです。

---

### 2. メールフィンガープリント除去 (Stealth Mode)

オリジナルのGophishは、送信されるすべてのメールに `X-Gophish-Contact` と `X-Gophish-Signature` ヘッダーを追加します。

**Enhancedの改善**：
- `X-Gophish` で始まるすべてのヘッダーフィールドを完全に削除しました。
- `X-Mailer` ヘッダーを一般的なメールクライアント（例：`Microsoft Outlook 16.0` や `Zoho Mail`）に偽装し、通常のトラフィックに紛れ込ませることで、SOCやメールゲートウェイによる識別を極めて困難にします。

---

### 3. ローカライズ管理インターフェース

中国語ユーザー向けにGophishの管理画面をローカライズし、日常業務で最も頻繁に使用されるモジュールをカバーしました：
- **Campaign (キャンペーン)**：作成、編集、ダッシュボード
- **Users & Groups (ユーザーとグループ)**：ターゲットインポート、編集
- **Templates (テンプレート)**：ビジュアルエディタ
- **Landing Pages (フィッシングページ)**：ページエディタ

---

## 🚀 クイックスタート

### 方法 1：Docker実行（最速）

```bash
# 1. イメージをビルド
docker build -t gophish-enhanced .

# 2. コンテナを起動
# マッピングポート：3333(管理画面), 80(フィッシングサービス)
docker run -d \
  --name gophish \
  -p 3333:3333 \
  -p 80:80 \
  -v $(pwd)/gophish.db:/opt/gophish/gophish.db \
  gophish-enhanced
```

`https://127.0.0.1:3333` にアクセスして管理画面に入ります。

### 方法 2：ソースからビルド

```bash
# 1. プロジェクトをクローン
git clone https://github.com/25smoking/gophishV4Modified.git
cd gophishV4Modified

# 2. 依存関係をインストール
go get github.com/jaytaylor/html2text
go get github.com/skip2/go-qrcode

# 3. ビルド
go build -o gophish

# 4. 実行
./gophish
```

---

## ⚙️ コア設定 (config.json)

```json
{
  "admin_server": {
    "listen_url": "127.0.0.1:3333",
    "use_tls": true,
    "cert_path": "gophish_admin.crt",
    "key_path": "gophish_admin.key"
  },
  "phish_server": {
    "listen_url": "0.0.0.0:80",
    "use_tls": false,
    "enable_qrcode": true    // QRコード機能を有効化
  },
  "db_name": "sqlite3",
  "db_path": "gophish.db",
  "migrations_prefix": "db/db_"
}
```

---

## 🛡️ セキュリティポリシー（必読）

⚠️ **免責事項**：
本プロジェクトは、認可された企業セキュリティ構築、レッドチーム演習、およびセキュリティ意識向上トレーニングのみを目的としています。

1. **認可が必要**：本ツールを使用してテストを行う前に、必ずターゲットシステムの所有者から書面による認可を得る必要があります。
2. **違法使用の禁止**：本ツールを未承認の攻撃活動に使用することは厳禁です。
3. **データプライバシー**：演習データには非識別化情報を含める必要があり、演習終了後は速やかにデータベースファイルを破棄してください。

開発者は、本ツールの使用に起因する直接的または間接的な結果について一切の責任を負いません。

---

## 🤝 貢献とサポート

バグ報告や提案のためのIssueを歓迎します。

- **GitHub**: [github.com/25smoking/gophishV4Modified](https://github.com/25smoking/gophishV4Modified)

---

<div align="center">

Made with ❤️ for Security Professionals

</div>
